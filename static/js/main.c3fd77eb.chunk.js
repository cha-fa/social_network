(this.webpackJsonpsocial_network=this.webpackJsonpsocial_network||[]).push([[0],{39:function(e,t,n){},45:function(e,t,n){},49:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n.n(r),s=n(21),o=n.n(s),a=(n(39),n(40),n(3)),i=n(34),j=n(7),u=n(8),l=n(4),b=n(10),O=n.n(b),h="REGISTER_SUCCESS",d="REGISTER_FAILURE",p="LOGIN_SUCCESS",f="LOGIN_FAILURE",x="LOGOUT",m="EDIT_PROFILE",g=function(e){return function(t){fetch("http://thp-strapi-social-network.herokuapp.com/auth/local/register",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){var n,r,c;e.jwt?(O.a.set("token",e.jwt),t((r=e.user,c=e.jwt,{type:h,user:r,token:c})),localStorage.setItem("thp_social_network_user_obj",JSON.stringify(e))):(console.log(e),t((n=e.message[0].messages[0].message,{type:d,error:n})))}))}},v=function(e){return function(t){fetch("http://thp-strapi-social-network.herokuapp.com/auth/local",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){var n,r,c;e.jwt?(O.a.set("token",e.jwt),t((r=e.user,c=e.jwt,{type:p,user:r,token:c})),localStorage.setItem("thp_social_network_user_obj",JSON.stringify(e))):(console.log(e),t((n=e.message[0].messages[0].message,{type:f,error:n})))}))}},S=function(e){return function(t){fetch("http://thp-strapi-social-network.herokuapp.com/users/me",{method:"put",headers:{Authorization:"Bearer ".concat(O.a.get("token")),"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){e&&t({type:m,user:e})}))}},k=function(){return function(e){O.a.remove("token"),e({type:x}),console.log("USER WAS LOGGED OUT")}},_=n(20),E=n(18),N=(n(45),n(1)),y=function(e){var t=e.currentUser,n=Object(l.b)(),r=Object(j.h)(),c=Object(j.g)();return Object(N.jsx)("div",{className:"Navbar",children:Object(N.jsxs)("ul",{children:[Object(N.jsx)("header",{children:Object(N.jsxs)(u.b,{to:"/",children:[Object(N.jsx)(_.a,{size:100,className:"mb-3"}),Object(N.jsxs)("div",{children:[Object(N.jsx)(E.a,{size:30,className:"mr-2"}),"Home"]})]})}),Object(N.jsxs)("div",{className:"Authentication",children:[!t&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(_.b,{size:30,className:"mr-2"}),Object(N.jsx)(u.b,{to:{pathname:"/login",previous:{location:r}},children:"Login"}),Object(N.jsxs)("p",{children:[Object(N.jsx)("span",{children:Object(N.jsx)(_.d,{size:30,className:"mr-2"})}),Object(N.jsx)(u.b,{to:"/register",children:"Create an account"})]})]}),t&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(E.b,{size:30,className:"mr-2"}),Object(N.jsxs)(u.b,{to:"/profile",children:["@",t.username]}),Object(N.jsxs)("p",{onClick:function(){n(k()),c.push("/")},children:[Object(N.jsx)("span",{children:Object(N.jsx)(_.c,{className:"mr-2",size:30})}),"Log out"]})]})]})]})})},C=n(6),w=function(){var e=Object(j.h)(),t=e.pathname;return console.log(e),Object(N.jsx)("div",{className:"Jumbotron ",children:Object(N.jsx)("div",{className:"text-right",children:"/login"===t&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("h2",{children:" WELCOME BACK"}),Object(N.jsx)("h4",{children:" We missed you!"})]})||Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("h2",{children:" WELCOME ON MY SOCIAL NETWORK"}),Object(N.jsxs)("h5",{children:[" ","This website is a training to Redux and React. ",Object(N.jsx)("br",{}),"We use auth and routing to create a small social media website."]}),Object(N.jsx)(u.b,{to:"/register",children:"JOIN US"})]})})})},U=function(e){var t=e.location,n=Object(r.useState)(""),c=Object(C.a)(n,2),s=c[0],o=c[1],a=Object(r.useState)(""),i=Object(C.a)(a,2),u=i[0],b=i[1],O=Object(l.b)(),h=Object(l.c)((function(e){return e.auth})),d=Object(j.g)();return Object(r.useEffect)((function(){if(h.user){var e=t.previous?t.previous.location.pathname:"/";d.push(e)}}),[h]),Object(N.jsxs)("div",{className:"Login",children:[Object(N.jsx)(w,{}),Object(N.jsxs)("form",{onSubmit:function(e){e.preventDefault(),O(v({identifier:s,password:u}))},children:[Object(N.jsxs)("div",{children:[Object(N.jsx)("p",{children:"Username or Email:"}),Object(N.jsx)("input",{type:"text",id:"identifier",name:"identifier",required:!0,value:s,onChange:function(e){return o(e.target.value)}})]}),Object(N.jsxs)("div",{children:[Object(N.jsx)("p",{children:"Password:"}),Object(N.jsx)("input",{type:"password",id:"password",name:"password",required:!0,value:u,onChange:function(e){return b(e.target.value)}})]}),Object(N.jsx)("input",{type:"submit",value:"Sign in"})]}),h.error&&Object(N.jsxs)("p",{children:[" Erreur : ",h.error]})]})},T=n(24),P="FETCH_POSTS_REQUEST",L="FETCH_POSTS_SUCCESS",R="FETCH_POSTS_ERROR",I="SET_POSTS_COUNT",z="ADD_POST_SUCCESS",D="ADD_POST_ERROR",A="EDIT_POST",F="DELETE_POST",J=function(e){return{type:A,post:e}},B=function(e){return function(t){var n="http://thp-strapi-social-network.herokuapp.com/posts?_sort=created_at:DESC",r="http://thp-strapi-social-network.herokuapp.com/posts/count?_sort=created_at:DESC";e&&(n="http://thp-strapi-social-network.herokuapp.com/posts?_sort=created_at:DESC&user.slug=".concat(e),r="http://thp-strapi-social-network.herokuapp.com/posts/count?_sort=created_at:DESC&user.slug=".concat(e)),t({type:P}),fetch(r).then((function(e){return e.json()})).then((function(e){e.error||t({type:I,count:e})})),fetch(n).then((function(e){return e.json()})).then((function(e){var n;e.error?t((n=e.error,{type:R,error:n})):t({type:L,currentPosts:e})}))}},q=function(e){return function(t){fetch("https://thp-strapi-social-network.herokuapp.com/posts",{method:"post",headers:{Authorization:"Bearer ".concat(O.a.get("token")),"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){e.error?(console.log(e),t({type:D,error:e})):t({type:z,post:e})}))}},G=function(e){return function(t){fetch("http://thp-strapi-social-network.herokuapp.com/posts/".concat(e),{method:"delete",headers:{Authorization:"Bearer ".concat(O.a.get("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){e&&t({type:F,post:e})}))}},M=n(11),H=function(e){var t=e.post,n=e.currentUser,c=t.likedUsers.filter((function(e){return e.id===n.id})).length>0,s=Object(r.useState)(c),o=Object(C.a)(s,2),a=o[0],i=o[1],j=Object(l.b)(),u=function(){j(function(e,t,n){return function(r){var c,s={like:(c=e?[].concat(Object(T.a)(t.likedUsers),[n]):t.likedUsers.filter((function(e){return e.id!==n.id}))).length,likedUsers:c};fetch("http://thp-strapi-social-network.herokuapp.com/posts/".concat(t.id),{method:"put",headers:{Authorization:"Bearer ".concat(O.a.get("token")),"Content-Type":"application/json"},body:JSON.stringify(s)}).then((function(e){return e.json()})).then((function(e){e.error||r(J(e))}))}}(!a,t,n)),i(!a)};return Object(N.jsx)("span",{className:"Likes",children:n&&Object(N.jsxs)(N.Fragment,{children:[a&&Object(N.jsx)(M.a,{size:30,onClick:u})||Object(N.jsx)(M.e,{size:30,onClick:u})," ",t.likedUsers.length]})})},W=n(32),Y=n.n(W),X=function(e){var t=e.post,n=Object(r.useRef)(),c=Object(r.useState)(!1),s=Object(C.a)(c,2),o=s[0],a=s[1],i=Object(l.c)((function(e){return e.auth.user})),j=Object(r.useState)(t.text),b=Object(C.a)(j,2),h=b[0],d=b[1],p=Object(l.b)(),f=function(){o?(p(function(e,t){return function(n){fetch("http://thp-strapi-social-network.herokuapp.com/posts/".concat(t),{method:"put",headers:{Authorization:"Bearer ".concat(O.a.get("token")),"Content-Type":"application/json"},body:JSON.stringify({text:e})}).then((function(e){return e.json()})).then((function(e){e&&n(J(e))}))}}(n.current.value,t.id)),d(n.current.value),a(!1)):a(!0)};return Object(N.jsxs)("div",{className:"PostCard",children:[i&&Object(N.jsx)("div",{children:Object(N.jsxs)(u.b,{to:"/users/"+t.user.slug,children:["@",t.user.username]})}),i&&i.id===t.user.id&&o&&Object(N.jsx)("input",{ref:n,placeholder:h,defaultValue:h})||i&&Object(N.jsxs)("div",{className:"PostCard_content",children:[Object(N.jsx)("p",{children:h})," ",Object(N.jsx)(H,{currentUser:i,post:t})]})||Object(N.jsx)("p",{children:h}),Object(N.jsxs)("div",{className:"PostCard_footer",children:[Object(N.jsx)(Y.a,{format:"MM/DD/YYYY \xe0 HH:MM",children:t.created_at}),i&&t.user.id===i.id&&Object(N.jsxs)(N.Fragment,{children:[!o&&Object(N.jsx)("span",{className:"ml-3",children:Object(N.jsx)(M.d,{size:30,onClick:f})})||Object(N.jsx)("span",{className:"ml-3",children:Object(N.jsx)(M.b,{onClick:f,size:30})}),Object(N.jsx)(M.c,{className:"ml-3",size:30,onClick:function(){window.confirm("Es-tu s\xfbr ? Cette action est irr\xe9versible")&&p(G(t.id))}})]})]})]})},V=function(e){var t=e.posts,n=e.newPost;return Object(r.useEffect)((function(){console.log("new post has been published")}),[t,n]),Object(N.jsxs)("div",{className:"PostList",children:[Object(N.jsx)("div",{className:"d-flex justify-content-end mr-2",children:Object(N.jsxs)("p",{children:[t.count," posts"]})}),Object(N.jsx)("div",{className:"d-flex justify-content-center",children:Object(N.jsx)("ul",{className:"m-0 p-0",children:t.currentPosts&&t.currentPosts.map((function(e){return Object(N.jsx)(X,{post:e},e.id)}))})})]})},K=function(e){var t=e.currentUser,n=e.handleNewPost,c=Object(l.b)(),s=Object(r.useState)(""),o=Object(C.a)(s,2),a=o[0],i=o[1];return Object(N.jsx)("div",{className:"NewPost",children:Object(N.jsx)("form",{children:Object(N.jsxs)("div",{className:"d-flex align-content-center justify-content-center",children:[Object(N.jsx)("textarea",{type:"text",id:"text",name:"text",placeholder:"What's on your mind?",required:!0,rows:"3",maxLength:"280",value:a,onChange:function(e){return i(e.target.value)}}),Object(N.jsx)(M.f,{className:"ml-5 d-flex align-self-center",size:40,onClick:function(){var e={text:a,user:t.id};c(q(e)),n(e),i("")}})]})})})},Q=function(e){var t=e.currentUser,n=Object(r.useState)(),c=Object(C.a)(n,2),s=c[0],o=c[1],a=Object(l.b)(),i=Object(l.c)((function(e){return e.posts}));return Object(r.useEffect)((function(){a(B()),console.log("Ishould rerender")}),[s]),Object(N.jsxs)("div",{className:"Home",children:[t&&Object(N.jsx)(K,{currentUser:t,handleNewPost:function(e){o(e)}})||Object(N.jsx)(w,{}),Object(N.jsx)(V,{posts:i,newPost:s})]})},Z=function(){var e=Object(l.c)((function(e){return e.auth})),t=e.user,n=Object(r.useState)(t.username),c=Object(C.a)(n,2),s=c[0],o=c[1],a=Object(r.useState)(t.description),i=Object(C.a)(a,2),j=i[0],u=i[1],b=Object(l.b)();return Object(N.jsxs)("div",{className:"EditProfile",children:[Object(N.jsxs)("form",{children:[Object(N.jsxs)("div",{children:[Object(N.jsx)("label",{for:"username",children:"Username:"}),Object(N.jsx)("input",{type:"text",required:!0,value:s,onChange:function(e){return o(e.target.value)}})]}),Object(N.jsxs)("div",{children:[Object(N.jsx)("label",{for:"description",children:"Bio:"}),Object(N.jsx)("textarea",{type:"text",required:!0,value:j,onChange:function(e){return u(e.target.value)}})]}),Object(N.jsx)(M.b,{size:30,onClick:function(){b(S({username:s,description:j}))}})]}),e.error&&Object(N.jsxs)("p",{children:[" Erreur : ",e.error]})]})},$=function(e){var t=e.currentUser,n=Object(j.i)().userSlug,c=Object(r.useState)(t),s=Object(C.a)(c,2),o=s[0],a=s[1],i=Object(r.useState)(!1),u=Object(C.a)(i,2),b=u[0],h=u[1],d=Object(l.c)((function(e){return e.posts})),p=Object(l.b)();return Object(r.useEffect)((function(){n?(!function(){var e;n?e="http://thp-strapi-social-network.herokuapp.com/users?slug=".concat(n):(console.log("NO USER SLUG"),e="http://thp-strapi-social-network.herokuapp.com/users/me"),fetch(e,{method:"get",headers:{Authorization:"Bearer ".concat(O.a.get("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return a(e[0])}))}(),p(B(n))):(a(t),p(B(t.slug)))}),[n]),Object(N.jsxs)("div",{className:"Profile",children:[o&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)("h4",{children:[Object(N.jsx)(E.b,{size:50,className:"mr-2"}),o.username]}),Object(N.jsxs)("ul",{children:[Object(N.jsx)("h5",{children:"Email:"}),Object(N.jsx)("p",{children:o.email}),o.description&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)("h5",{children:"Bio: "}),Object(N.jsx)("p",{children:o.description})]})]})]}),o&&o.id===t.id&&b&&Object(N.jsx)(Z,{}),o&&o.id===t.id&&!b&&Object(N.jsx)("span",{children:Object(N.jsx)(M.d,{size:30,onClick:function(){return h(!b)}})}),Object(N.jsx)(V,{posts:d})]})},ee=function(){var e=Object(l.b)(),t=Object(l.c)((function(e){return e})),n=Object(j.g)(),c=Object(r.useState)(""),s=Object(C.a)(c,2),o=s[0],a=s[1],i=Object(r.useState)(""),u=Object(C.a)(i,2),b=u[0],O=u[1],h=Object(r.useState)(""),d=Object(C.a)(h,2),p=d[0],f=d[1];return Object(N.jsxs)("div",{className:"Registration",children:[Object(N.jsx)(w,{}),Object(N.jsx)("h2",{children:"Account Creation"}),Object(N.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e(g({username:o,email:b,password:p})),n.push("/")},children:[Object(N.jsxs)("div",{children:[Object(N.jsx)("p",{children:"Username:"}),Object(N.jsx)("input",{type:"text",required:!0,value:o,onChange:function(e){return a(e.target.value)}})]}),Object(N.jsxs)("div",{children:[Object(N.jsx)("p",{children:"Email:"}),Object(N.jsx)("input",{type:"text",required:!0,value:b,onChange:function(e){return O(e.target.value)}})]}),Object(N.jsxs)("div",{children:[Object(N.jsx)("p",{children:"Password:"}),Object(N.jsx)("input",{type:"password",required:!0,value:p,onChange:function(e){return f(e.target.value)}})]}),Object(N.jsx)("input",{type:"submit",value:"Sign up"})]}),t.error&&Object(N.jsxs)("p",{children:[" Erreur : ",t.error]})]})},te=function(e){var t=e.currentUser,n=Object(r.useState)(),c=Object(C.a)(n,2),s=c[0],o=c[1],a=Object(r.useState)(),i=Object(C.a)(a,2),j=i[0],l=i[1],b=Object(r.useState)(),h=Object(C.a)(b,2),d=h[0],p=h[1],f=Object(r.useState)(),x=Object(C.a)(f,2),m=x[0],g=x[1];return Object(r.useEffect)((function(){s&&s.length<1?l([]):fetch("https://thp-strapi-social-network.herokuapp.com/posts?_sort=created_at:DESC&text_contains=".concat(s)).then((function(e){return e.json()})).then((function(e){e.error||(console.log(e),l(e))}))}),[s]),Object(r.useEffect)((function(){d&&t?fetch("https://thp-strapi-social-network.herokuapp.com/users?_sort=created_at:DESC&username_contains=".concat(d),{method:"get",headers:{Authorization:"Bearer ".concat(O.a.get("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){e.error||(console.log(e),g(e))})):g([])}),[d]),Object(N.jsx)("div",{className:"RightNav ",children:Object(N.jsxs)("form",{children:[Object(N.jsxs)("div",{className:"mb-5 mt-5",children:["Looking for something?",Object(N.jsx)("input",{onChange:function(e){return o(e.target.value)},type:"text"}),Object(N.jsx)("ul",{className:"m-0 p-0",children:j&&j.map((function(e){return Object(N.jsx)(X,{post:e},e.id)}))})]}),t&&Object(N.jsxs)("div",{children:["Looking for someone?",Object(N.jsx)("input",{onChange:function(e){return p(e.target.value)},type:"text"}),Object(N.jsx)("ul",{className:"m-0 p-0",children:m&&m.map((function(e){return Object(N.jsx)("p",{children:Object(N.jsxs)(u.b,{to:"/users/"+e.slug,children:["@",e.username]})})}))})]})]})})},ne=function(){var e=Object(l.c)((function(e){return e.auth.user})),t=function(t){var n=t.component,r=Object(i.a)(t,["component"]);return Object(N.jsx)(j.b,Object(a.a)(Object(a.a)({},r),{},{render:function(t){return e?Object(N.jsx)(n,Object(a.a)({},t)):Object(N.jsx)(j.a,{to:{pathname:"/login"}})}}))};return Object(N.jsx)("container",{className:"SocialApp",children:Object(N.jsxs)(u.a,{basename:"/social_network",children:[Object(N.jsx)(y,{currentUser:e}),Object(N.jsxs)(j.d,{children:[Object(N.jsx)(j.b,{path:"/",exact:!0,children:Object(N.jsx)(Q,{currentUser:e})}),Object(N.jsx)(j.b,{path:"/social_network",children:Object(N.jsx)(Q,{currentUser:e})}),Object(N.jsx)(j.b,{path:"/register",component:ee}),Object(N.jsx)(j.b,{path:"/login",component:U}),Object(N.jsx)(t,{path:"/users/:userSlug",exact:!0,children:Object(N.jsx)($,{currentUser:e})}),Object(N.jsx)(t,{path:"/profile",children:Object(N.jsx)($,{currentUser:e})})]}),Object(N.jsx)(te,{currentUser:e})]})})},re=n(16),ce=n(33),se=JSON.parse(localStorage.getItem("thp_social_network_user_obj")),oe=se?se.user:null,ae={token:null,user:oe,isLoggedIn:!!oe,error:null},ie=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:case p:return Object(a.a)(Object(a.a)({},e),{},{token:t.token,user:t.user,isLoggedIn:!0,error:""});case d:case f:return Object(a.a)(Object(a.a)({},e),{},{error:t.error,token:null,user:null,isLoggedIn:!1});case x:return Object(a.a)(Object(a.a)({},e),{},{isLoggedIn:!1,token:null,user:null});case m:return Object(a.a)(Object(a.a)({},e),{},{user:t.user,token:t.token,isLoggedIn:!0});default:return e}},je={loading:!1,currentPosts:[],error:"",count:0},ue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:je,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return Object(a.a)(Object(a.a)({},e),{},{loading:!0});case L:return Object(a.a)(Object(a.a)({},e),{},{loading:!1,currentPosts:t.currentPosts});case R:return Object(a.a)(Object(a.a)({},e),{},{loading:!1,error:t.error});case I:return Object(a.a)(Object(a.a)({},e),{},{count:t.count});case D:return Object(a.a)(Object(a.a)({},e),{},{error:t.error});case z:return Object(a.a)(Object(a.a)({},e),{},{currentPosts:[].concat(Object(T.a)(e.currentPosts),[t.post])});case A:return Object(a.a)(Object(a.a)({},e),{},{currentPosts:e.currentPosts.map((function(e){return e.id===t.post.id?t.post:e}))});case F:return Object(a.a)(Object(a.a)({},e),{},{currentPosts:e.currentPosts.filter((function(e){return e.id!==t.post.id}))});default:return e}},le=Object(re.c)({auth:ie,posts:ue}),be=Object(re.e)(le,Object(re.d)(Object(re.a)(ce.a),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));o.a.render(Object(N.jsx)(c.a.StrictMode,{children:Object(N.jsx)(l.a,{store:be,children:Object(N.jsx)(ne,{})})}),document.getElementById("root"))}},[[49,1,2]]]);
//# sourceMappingURL=main.c3fd77eb.chunk.js.map